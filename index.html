<!DOCTYPE html>
<html>
  <head>
    <title>Localização em tempo real</title>
    <meta charset="utf-8">
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA1vd8VeMpyb-78vmQuyXKntuIT54EqNVo&callback=initMap"
      async
      defer
    ></script>
  </head>
  <body>
    <div id="map"></div>

    <script>
      let map;
      let marker;

      async function buscarDados() {
        try {
          const response = await fetch(
            'https://script.google.com/macros/s/AKfycbzLmYfAHjjgIkw1fGJGqkPqd9ORw1NZ5y0nNB57JOsQSfHQixXxJuYHqnqyK6--UPew/exec'
          );

          const dados = await response.json();
          return {
            lat: parseFloat(dados.lat),
            lng: parseFloat(dados.lon),
            info: `
              <strong>Velocidade:</strong> ${dados.speed} km/h<br>
              <strong>Altitude:</strong> ${dados.alt} m<br>
              <strong>HDOP:</strong> ${dados.hdop}<br>
              <strong>SATs:</strong> ${dados.sats}<br>
              <strong>UTC:</strong> ${dados.time}
            `
          };
        } catch (error) {
          console.error("Erro ao buscar dados do GPS:", error);
          return null;
        }
      }

      async function initMap() {
        const dados = await buscarDados();

        if (!dados) {
          alert("Não foi possível carregar dados do GPS.");
          return;
        }

        map = new google.maps.Map(document.getElementById("map"), {
          center: dados,
          zoom: 18
        });

        marker = new google.maps.Marker({
          position: dados,
          map: map
        });

        const infoWindow = new google.maps.InfoWindow({
          content: dados.info
        });

        marker.addListener("click", () => {
          infoWindow.open(map, marker);
        });

        // Atualiza a posição a cada 5 segundos
        setInterval(async () => {
          const novosDados = await buscarDados();
          if (novosDados) {
            marker.setPosition(novosDados);
            map.setCenter(novosDados);
            infoWindow.setContent(novosDados.info);
          }
        }, 5000);
      }
    </script>
  </body>
</html>
