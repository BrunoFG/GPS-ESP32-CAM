<!DOCTYPE html>
<html>
  <head>
    <title> Localização em tempo real </title>
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
      const planilhaID = '1UpJkC9qR23bMcmdo4sGqaPtDNgmTc5AISo3dikYoWgY'; // Substitua com o ID da sua planilha
      const aba = 'Dados'; // Nome da aba

      async function buscarLocalizacao() {
        const url = `https://docs.google.com/spreadsheets/d/${planilhaID}/gviz/tq?tqx=out:json&sheet=${aba}`;
        const res = await fetch(url);
        const texto = await res.text();
        const json = JSON.parse(texto.substring(47).slice(0, -2)); // Remove os parênteses do retorno
        const dados = json.table.rows;

        if (dados.length > 0) {
          const ultimaLinha = dados[dados.length - 1].c;
          const lat = parseFloat(ultimaLinha[0].v);
          const lon = parseFloat(ultimaLinha[1].v);

          atualizarMapa(lat, lon);
        }
      }

      let mapa;
      let marcador;

      function initMap() {
        mapa = new google.maps.Map(document.getElementById("map"), {
          zoom: 18,
          center: { lat: 0, lng: 0 },
        });

        marcador = new google.maps.Marker({
          map: mapa,
        });

        // Atualiza a cada 5 segundos
        setInterval(buscarLocalizacao, 5000);
      }

      function atualizarMapa(lat, lon) {
        const pos = { lat, lng: lon };
        mapa.setCenter(pos);
        marcador.setPosition(pos);
      }
    </script>

    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA1vd8VeMpyb-78vmQuyXKntuIT54EqNVo&callback=initMap">
    </script>
  </body>
</html>
