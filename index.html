<!DOCTYPE html>
<html>
  <head>
    <title>Rastreamento em Tempo Real - ESP32</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script>
      let map;
      let marker;

      async function getGPSData() {
        try {
          const response = await fetch("https://script.google.com/macros/s/AKfycbzLmYfAHjjgIkw1fGJGqkPqd9ORw1NZ5y0nNB57JOsQSfHQixXxJuYHqnqyK6--UPew/exec");
          const data = await response.json();

          const lat = parseFloat(data.lat);
          const lng = parseFloat(data.lon);
          const position = { lat, lng };

          if (!marker) {
            // Primeira vez: cria o mapa e marcador
            map = new google.maps.Map(document.getElementById("map"), {
              center: position,
              zoom: 16,
            });

            marker = new google.maps.Marker({
              position,
              map,
              title: "Posição Atual",
            });
          } else {
            // Atualiza a posição do marcador
            marker.setPosition(position);
            map.panTo(position);
          }

          console.log("Dados recebidos:", data);
        } catch (error) {
          console.error("Erro ao buscar dados do GPS:", error);
        }
      }

      function initMap() {
        // Chama uma vez no início
        getGPSData();

        // Atualiza a cada 5 segundos
        setInterval(getGPSData, 5000);
      }
    </script>

    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA1vd8VeMpyb-78vmQuyXKntuIT54EqNVo&callback=initMap&loading=async">
    </script>
  </body>
</html>
